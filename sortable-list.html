<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../sortable/sortable.html">
<!--
`sortable-list`
Simple, flexible drag-and-drop sortable lists utilizing the excellent
[Sortable.js](http://rubaxa.github.io/Sortable/) library under the covers.

##### Example

    <sortable-list content="{{content}}" output="{{output}}">
    </sortable-list>

@demo demo/index.html
-->
<dom-module id="sortable-list">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <sortable-js handle=".handle" on-sort="onSort">
      <template is="dom-repeat" items="{{content}}">
        <div data-id="[[index]]">{{item}}</div>
      </template>
    </sortable-js>
  </template>
  <script>
    Array.prototype.move = function (old_index, new_index) {
      if (new_index >= this.length) {
        var k = new_index - this.length
        while ((k--) + 1) {
          this.push(undefined)
        }
      }
      this.splice(new_index, 0, this.splice(old_index, 1)[0])
    }
    Polymer({
      is: 'sortable-list',
      properties: {
        /**
         * Input
         */
        content: {type: Array, value: []},
        /**
         * Output
         */
        output: {type: Array, notify: true, computed: "getOutput(content)"}
      },
      getOutput: function (content){
        return content
      },
      /**
       * Triggered on add, remove, or update.
       * @event sort-change
       */
      onSort: function (evt) {
        this.content.move(evt.oldIndex, evt.newIndex)
        this.set("content", this.content)
      }
    })
  </script>
</dom-module>
